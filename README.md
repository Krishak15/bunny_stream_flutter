# bunny_stream_flutter

Flutter wrapper for Bunny.net Stream SDK (Android + iOS) focused on video playback/retrieval flows.

## Platform requirements

- Flutter SDK: `>=3.38.4`
- Android: minSdk `26`
- iOS: `15.0+`

## What you need from Bunny.net Console

Before calling the plugin, collect these values from Bunny Stream dashboard:

1. **Stream Library ID** (`libraryId`)
2. **API Access Key** (`accessKey`) for your Stream Library
3. **Video ID** (`videoId`) for retrieval/playback
4. **Collection ID** (`collectionId`) if you use collections
5. **CDN Hostname** (`cdnHostname`, optional) if you use custom pull zone hostname
6. **Token auth inputs** (optional but recommended for production):
   - secure token generated by your backend (`token`)
   - expiry timestamp (`expires`, unix seconds)

## Environment configuration (.env)

For development testing, store credentials in a `.env` file (see [example/ENV_SETUP.md](example/ENV_SETUP.md)):

```env
BUNNY_LIBRARY_ID=12345
BUNNY_ACCESS_KEY=your-stream-access-key
BUNNY_VIDEO_ID=your-video-guid
BUNNY_CDN_HOSTNAME=
BUNNY_SECURE_TOKEN=
BUNNY_EXPIRES=
```

The example app loads credentials from `.env` on startup. **Never commit `.env` to version control.**

## Auth requirements (important)

- Do not hardcode production `accessKey` in client apps.
- Recommended flow:
	1. Mobile app authenticates user against your backend.
	2. Backend stores Bunny secret/key and generates short-lived token/expires.
	3. App calls plugin methods using those server-issued values.
- If token authentication is enabled for your video delivery, you must provide valid `token` + `expires` to playback requests.

## API status in current integration slice

- Implemented end-to-end:
	- `initialize(...)`
	- `getVideoPlayData(...)`
- Wired but pending native SDK call implementation:
	- `listVideos(...)`, `getVideo(...)`
	- `listCollections(...)`, `getCollection(...)`

## Flutter quick start

```dart
final bunny = BunnyStreamFlutter();

await bunny.initialize(
	accessKey: 'YOUR_STREAM_ACCESS_KEY',
	libraryId: 12345,
	cdnHostname: 'vz-12345.b-cdn.net', // optional
);

final playData = await bunny.getVideoPlayData(
	libraryId: 12345,
	videoId: 'VIDEO_GUID',
	token: 'OPTIONAL_SECURE_TOKEN',
	expires: 1735689600,
);

print(playData.playlistUrl);
print(playData.fallbackUrl);
```

## Android example

```dart
import 'dart:io' show Platform;

Future<void> initAndroid(BunnyStreamFlutter bunny) async {
	if (!Platform.isAndroid) return;

	await bunny.initialize(
		accessKey: 'ANDROID_LIBRARY_ACCESS_KEY',
		libraryId: 12345,
		cdnHostname: 'vz-12345.b-cdn.net',
	);

	final playData = await bunny.getVideoPlayData(
		libraryId: 12345,
		videoId: 'ANDROID_VIDEO_GUID',
	);

	print('Android playlist: ${playData.playlistUrl}');
}
```

## iOS example

```dart
import 'dart:io' show Platform;

Future<void> initiOS(BunnyStreamFlutter bunny) async {
	if (!Platform.isIOS) return;

	await bunny.initialize(
		accessKey: 'IOS_LIBRARY_ACCESS_KEY',
		libraryId: 12345,
		cdnHostname: 'vz-12345.b-cdn.net',
	);

	final playData = await bunny.getVideoPlayData(
		libraryId: 12345,
		videoId: 'IOS_VIDEO_GUID',
		token: 'SERVER_ISSUED_TOKEN',
		expires: 1735689600,
	);

	print('iOS fallback: ${playData.fallbackUrl}');
}
```

## Error handling

All method channel failures are wrapped as `BunnyStreamException`:

```dart
try {
	await bunny.initialize(accessKey: key, libraryId: libraryId);
} on BunnyStreamException catch (e) {
	// e.code, e.message, e.details
	print('Bunny error: $e');
}
```

